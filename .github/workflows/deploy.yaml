name: Deploy to GitHub Pages

on:
  push:
    branches: [ main ]

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

        - name: Setup Node.js
          uses: actions/setup-node@v4
            with:
              node-version: '20'

      - name: Completely reset npm authentication
        run: |
          # Remove any existing npm config
          rm -f ~/.npmrc
          rm -f ./.npmrc

          # Clear npm cache and logout
          npm cache clean --force
          npm logout 2>/dev/null || true

          # Set only public registry with no auth
          npm config set registry https://registry.npmjs.org/
          npm config set @fortawesome:registry https://registry.npmjs.org/
          npm config delete //registry.npmjs.org/:_authToken 2>/dev/null || true

          # Verify config
          npm config list

      - name: Install dependencies
        run: npm install --no-optional
        env:
          NPM_CONFIG_REGISTRY: https://registry.npmjs.org/

      - name: Build
        run: npm run build
        env:
          VITE_API_URL: ${{ secrets.VITE_API_URL }}

      - name: Setup Pages
        uses: actions/configure-pages@v4

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v4
        with:
          path: './dist'

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4